"use strict";function addRequest_POST(t,a){console.log("post1",t);var e=$.ajax({url:"new_message.php",method:"POST",data:t,dataType:"text"});e.done(function(e){var n=JSON.parse(e);console.log(n),"留言成功"===n.msg?(n.nickname=t.nickname,n.content=t.content,appendMessage(n,a)):alert(n.msg)}),e.fail(function(e,n){alert("Request failed: "+n)})}function appendMessage(e,n){var t=new Date,a=t.getFullYear()+"-"+(t.getMonth()+1)+"-"+t.getDate()+" "+t.getHours()+":"+t.getMinutes()+":"+t.getSeconds();if("container"===n.classList[0]){var r=n.children[1].cloneNode(!0);n.insertBefore(r,n.children[2]),r.className="message__block",r.children[0].children[0].innerText=e.nickname,r.children[0].children[1].innerText=a,r.children[1].childNodes[0].nodeValue=e.content,r.children[1].children[0].value=btoa(e.id),r.children[2].children[0].children[0].className="js_"+e.id,document.querySelector(".js_"+e.id+" .nickname").value=e.nickname,document.querySelector(".js_"+e.id+" .parent").value=btoa(e.id)}else{var l=n.parentElement.parentElement.children[1].children[0].cloneNode(!0),i=n.parentElement.parentElement.children[1].children[1].cloneNode(!0);n.insertBefore(i,n.children[0]),n.insertBefore(l,n.children[0]),l.children[0].innerText=e.nickname,l.children[1].innerText=a,i.childNodes[0].nodeValue=e.content,!0===e.same_user&&(l.className+=" self__message",i.className+=" self__message"),i.children[0].value=btoa(e.id)}}document.addEventListener("DOMContentLoaded",function(){document.querySelector("body").addEventListener("click",function(e){if("btn__submit"===e.target.classList[2]){event.preventDefault();var n={},t=new FormData(e.target.parentElement),a=!0,r=!1,l=void 0;try{for(var i,c=t.entries()[Symbol.iterator]();!(a=(i=c.next()).done);a=!0){var d=i.value;n[d[0]]=d[1]}}catch(e){r=!0,l=e}finally{try{!a&&c.return&&c.return()}finally{if(r)throw l}}n.nickname=nickname;var o=e.target.parentElement.parentElement.parentElement;console.log("post",n),addRequest_POST(n,o),e.target.parentElement.children[1].children[1].children[0].value=""}})});